# Asset Class Trend Following 策略重現報告 (含停損機制最佳化)

## 1. 策略說明
本策略嚴格遵循「個股V2.docx」與「reproduce_strategy-停損測試.md」之要求，使用 Asset Class Trend Following 方法進行 122 檔個股回測。
- **資料來源**: `0205/data.xlsx`。
- **初始資金**: 3,000 萬元。
- **最大持股**: 3 檔。
- **再平衡週期**: 每 5 個交易日。
- **核心指標**: SMA (30) 與 ROC (100)。
- **資料清理**: 使用 `ffill()` 補齊中間缺漏，再以 `bfill()` 補齊起始缺漏。
- **進場邏輯**: 價格高於 SMA 且 ROC 為正，選取 ROC 前 3 名。
- **交易執行**: T 日產生訊號，T+1 日以收盤價執行。
- **持倉管理**: 若原有持股仍位列前 3 名，則「保持原股數續抱」，僅賣出跌出排名的標的。

## 2. 停損機制與最佳化流程
針對持有期間的標的，每日檢驗收盤價以決定是否觸發停損（T 日觸發，T+1 日出場）：
1. **最高價回落停損 (Peak-to-Trough Stop)**: 當收盤價相對持有期間最高收盤價跌幅超過 `StopLoss%`。
2. **移動平均線停損 (MA Stop)**: 當收盤價跌破短期均線 `MA_stop`。

### 螞蟻演算法 (ACO) 最佳化
使用 ACO 在指定範圍內搜尋最佳參數，目標函數為最大化 **Calmar Ratio**。
- **最佳化結果**:
  - **最佳停損機制**: **均線停損 (MA Stop)**
  - **最佳參數**: `MA_stop = 15`
  - **最佳 Calmar Ratio**: **3.45** (基準策略不含停損為 3.18)

## 3. 最終策略績效
使用最佳化參數 (SMA=30, ROC=100, MA_stop=15) 之回測結果：
- **年化報酬率 (CAGR)**: 111.74%
- **最大回撤 (MaxDD)**: -32.38%
- **Calmar Ratio**: 3.45
- **勝率**: 48.87%

## 4. 參數高原表 (SMA vs Calmar, ROC=100)
| SMA | CAGR | MaxDD | Calmar |
|-----|------|-------|--------|
| 10 | 118.07% | -45.23% | 2.61 |
| 20 | 120.68% | -46.31% | 2.61 |
| 30 | 132.30% | -41.67% | 3.18 |
| 40 | 123.48% | -45.55% | 2.71 |
| 50 | 112.73% | -45.78% | 2.46 |
| 60 | 119.68% | -45.37% | 2.64 |
| 80 | 123.47% | -53.72% | 2.30 |
| 100 | 147.13% | -54.63% | 2.69 |
| 120 | 126.28% | -46.53% | 2.71 |
| 150 | 128.95% | -48.05% | 2.68 |
| 200 | 137.18% | -47.88% | 2.87 |

## 5. 檔案清單與說明
- `final_strategy.ipynb`: 包含完整資料清理、ACO 最佳化及回測邏輯的程式碼。
- `strategy_results.xlsx`: 詳細交易紀錄 (Trades)、權益曲線 (Equity_Curve)、持倉明細 (Equity_Hold) 與 績效總結 (Summary)。
- `reproduce_report.md`: 本說明文件。
