# Asset Class Trend Following 策略重現指南

## 1. 策略邏輯說明
本策略嚴格遵循「個股V2.md」之要求，使用 Asset Class Trend Following 方法。
- **資產池**: 122 檔標的 (來自 data.xlsx)。
- **資金**: 初始資金 3,000 萬元。
- **指標**: 簡單移動平均線 (SMA) 與 變動率 (ROC)。
- **資料清理**: 採用 `ffill()` 填補中間空值，再以 `bfill()` 填補初始空值。
- **進場條件**: 當價格高於 SMA 且 ROC 為正。
- **排名依據**: 符合條件標的中，依 ROC 由高到低排名，取前 3 名。
- **再平衡週期**: 每 5 個交易日重新評估。
- **交易執行**: T 日產生訊號，T+1 日以收盤價執行。
- **持倉邏輯**: 若原有持股仍位列前 3 名，則「保持原股數續抱」，僅賣出跌出排名的標的，並將所得資金投入新進標的。

## 2.新增停損機制
在持有股票至下一個平衡日之前，逐日檢驗收盤價，若符合以下任一條件，則 T+1 日停損出場，並空手至下一個平衡日時再依新訊號新增或剃除持股：
1. 最高價回落停損 (Peak-to-Trough Stop)
o 定義: 當收盤價相對持有期間最高收盤價跌幅超過一個參數值 (StopLoss%) 時觸發。
o 參數: StopLoss% ∈ [2%, 10%] (由螞蟻演算法搜尋最佳值)。
2. 移動平均線停損 (MA Stop)
o 定義: 當收盤價跌落一個短期移動平均線 (MA_stop) 之下時觸發。
o 參數: MA_stop ∈ [3, 15] (由螞蟻演算法搜尋最佳值)。
2. 最佳化流程
• 演算法: 使用螞蟻演算法 (Ant Colony Optimization, ACO) 搜尋最佳停損參數。
• 目標函數: 最大化 Calmar Ratio (CAGR / |MaxDD|)。
• 流程:
1. 固定 SMA=30, ROC=100 (最佳基準)。
2. 對停損機制 1 與 2 分別進行參數搜尋。
3. 比較兩組最佳結果，選擇 Calmar Ratio 較高者作為最終策略。
## 3. 最佳參數與績效(含停損機制)
• 最佳 SMA 週期: 30
• 最佳 ROC 週期: 100
• 最佳停損機制: (由 ACO 搜尋結果決定)
• 年化報酬率 (CAGR): [待回測結果]
• 最大回撤 (MaxDD): [待回測結果]
• Calmar Ratio: [待回測結果]

## 3. 參數高原表 (SMA vs Calmar, ROC=100)
| SMA | CAGR | MaxDD | Calmar |
|-----|------|-------|--------|
