雙動能交易策略--雙動能 (Dual Momentum)回測專案說明
策略目標
Calmar Ratio > 4

最大回撤 (MDD) < 15%

年化報酬率 > 100%

資金配置
初始資金：新台幣 1000 萬元

每次單筆投入：1000 萬元

平均分配至 最強動能前 2 檔商品

資料來源
檔案：資料2.xls

內容：16 種商品的 周收盤價

特性：

商品起始時間不一致

回測時，隨著新商品逐步加入，擴大樣本群

例：

2017/5/2 → 5 檔商品

2017/7/24 → 9 檔商品

2017/9/4 → 10 檔商品

2017/10/2 → 11 檔商品

策略流程
計算動能
# 策略參數最佳化方法，使用螞蟻演算法

## 目標優先順序
- 最終策略必須以 **Calmar ratio 最高** 為唯一目標。
- 若全域最佳化能提供更高的 Calmar ratio，則選擇全域最佳化。
- 若逐標的最佳化能提供更高的 Calmar ratio，則選擇逐標的最佳化。

## 1. 全域最佳化 (Global Optimization)
- 定義一組參數 (例如 [3, 15] 周)。可以是過去單周期、或是過去雙周期平均、或是三周期平均
- 對所有商品套用同一組參數。
- **若此方法的 Calmar ratio > 逐標的最佳化，則最終採用此方法。**

## 2. 逐標的最佳化 (Per-Asset Optimization)
- 每個商品各自測試多組候選週期參數：
  - 單週期 (如 13 周)
  - 雙週期平均 (如 4 與 17 周)
  - 三週期平均 (如 3、9、19 周)
- 為每個商品找出「自己最佳化後的參數組合」。
- 在每次再平衡時：
  1. 使用各商品的最佳化分數。
  2. 排序挑選前 2 檔。
  3. 平均分配資金。
- **若此方法的 Calmar ratio > 全域最佳化，則最終採用此方法。**

## 3. 策略選擇規則
- 在回測完成後，計算兩種方法的 Calmar ratio。
- **選擇 Calmar ratio 較高的方法作為最終回測結果。**

4. 輸出結果
篩選標的

選取 報酬率為正值 的前 2 檔商品

作為投資組合配置

交易規則

每周重新配置一次。當周收盤價作為進出場價，計算持有期間報酬率
# 策略再平衡與持股規則

## 1. 新一期持股判斷
- 若新一期篩選出的商品與上一期相同，則 **保留原有持股數**。
- 不重新依照新一期股價計算股數。
- 目的：確保損益計算正確，避免因股數變動而影響報酬率。

## 2. 新增標的
- 若新一期篩選出的商品為新標的，則依照資金配置原則計算股數。

## 3. 移除標的
- 若上一期持有商品未被新一期選中，則在新一期收盤價全數賣出，並計算損益。

## 4. 損益計算原則
- 保留標的：沿用前一期股數，依新一期收盤價計算市值。
- 新增標的：依資金配置原則計算股數。
- 移除標的：依賣出價與原持股數計算損益。

程式設計需求
所有程式碼放在同一個 ipynb 檔案，並把所有參數集中在同一區域，以利後續修改較為集中

必須有 結構嚴謹、詳細繁體中文註解

輸出結果:
1. Excel 檔案：strategy_results.xlsx

頁面一:Trades：交易明細(含買進日期、標的名稱、價格、股數、每周平衡時保留倉與上一期相同之商品、賣出剃除商品、買進新持有商品、價格、股數、每期報酬表現)，包含每檔商品的最佳參數。買進參數詳細內容 (可多欄)原因。最後一欄：繁體中文說明選取出的資產及其相對動能值

頁面二:Equity_Curve:每期權益變化數據、權益曲線圖 (含回撤陰影)

頁面三:Equity_Hold:每期持股檔數與明細

頁面四:Summary:包含

CAGR

MaxDD

Calmar Ratio

勝率 (Win Rate)

最佳參數

每年度年化報酬率

2. Markdown 文件 (繁體中文)
嚴謹清晰

詳細計算步驟

可讓 AI 或研究者完整重現程式與結果

3. 參數高原表
將所有最佳化的參數值整理成表格

顯示不同週期組合下的績效表現

範例表格：參數高原表
參數組合	CAGR	MaxDD	Calmar	勝率	備註
12 周	105%	14%	7.5	62%	單參數最佳
5, 11 周	110%	13%	8.4	65%	雙參數最佳
4, 9, 15 周	102%	12%	8.5	63%	三參數穩定

